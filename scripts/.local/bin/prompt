#!/usr/bin/env bash

# Show an Emacs `helm` prompt, dmenu-style.
# $1 - prompt message/title.
# stdin - candidates separated with newlines.

# There is no easy way to pass things into `emacsclient` stdin, so we write the
# candidates to a file which is then read by `prompt` in elisp.
file=$(mktemp /tmp/promptXXXXX)
cat > $file

# Ugly elisp function call. Pass the message and the candidates file name.
output=$(emacsclient -e "(prompt \"${1:-Select something}: \" \"$file\")")

# nil = cancelled with C-g.
if [ "$output" != nil ]; then
    # Output comes the following format:
    # "selection1
    # selection2
    # etc.
    # "
    # Which is why we remove the leading " and the \n" tail.
    echo -e "${output:1:-3}"
fi

# Get rid of the evidence.
rm "$file"
