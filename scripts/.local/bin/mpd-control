#!/bin/bash

host=185.222.117.80
port=6600
http_port=8000

http="http://$host:$http_port"

mpc playlist | grep $http > /dev/null || mpc add $http

function _mpc {
    mpc --host=$host --port=$port "$@"
}

function notify {
    notify-send "$@"
    echo "$@"
}

_mpc repeat on > /dev/null &

function queue {
    echo "$1" | while read track; do
        _mpc search filename "$track" | _mpc add
    done

    _mpc play
}

function play {
    _mpc stop
    _mpc clear

    queue "$1"

    mpc stop
    mpc play

    notify "Playing"
}

function start_selection {
    _mpc listall | prompt "Select a track"
}

function pause {
    _mpc pause
    mpc stop
    notify "Paused"
}

function resume {
    _mpc play
    mpc play
    notify "Resumed"
}

function status {
    status=$(_mpc status)
    notify "Status" "$status"
    echo "$status"
}

cmd=$@

case "$cmd" in
select)
    result=$(start_selection)
    [ "$result" ] && play "$result"
    ;;
queue)
    result=$(start_selection)
    [ "$result" ] && queue "$result"
    ;;
toggle)
    _mpc | grep playing && pause || resume
    ;;
status)
    status
    ;;
http)
    echo "$http"
    ;;
next)
    _mpc next && status
    ;;
prev)
    _mpc prev && status
    ;;
single)
    _mpc single && status
    ;;
*)
    _mpc "$@"
    ;;
esac
