#!/bin/bash

host=185.222.117.80
port=6600
http_port=8000

http="http://$host:$http_port"
[ -z $(mpc playlist | grep $http) ] && mpc add $http

function _mpc {
    mpc --host=$host --port=$port "$@"
}

function _dmenu {
    dmenu-xresources -i -p "$1"
}

function path_to_track {
    echo "$@" | sed 's/\// - /g; s/\.mp3//g'
}

function track_to_path {
    echo "$@.mp3" | sed 's/ - /\//g'
}

function play {
    track="$1"

    _mpc stop
    _mpc clear
    _mpc search filename "$track" | _mpc add
    _mpc play

    mpc play
    notify-send "Now Playing" "$(path_to_track $track)"
}

function listall {
    path_to_track "$(_mpc listall)"
}

cmd=$@

if [ "$cmd" = select ]; then
    result=$(listall | _dmenu "Select a song")
    [ "$result" ] && play "$(track_to_path $result)"
elif [ "$cmd" = interactive ]; then
    artist=$(_mpc ls | _dmenu "Select an artist")
    [ "$artist" ] && album=$(_mpc ls "$artist" | _dmenu "Select an album")
    [ "$album" ] && track=$(_mpc ls "$album" | _dmenu "Select a track")
    [ "$track" ] && play "$track"
elif [ "$cmd" = toggle ]; then
    if [ "$(mpc | grep "playing")" ]; then
        mpc stop
        notify-send "Paused"
    else
        mpc play
        notify-send "Resumed"
    fi
else
    _mpc "$@"
fi
